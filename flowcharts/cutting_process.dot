digraph cutting_process {
    // Graph styling
    graph [fontname="Arial", rankdir="TB", splines=true, overlap=false, nodesep=0.8, ranksep=0.8];
    node [shape="box", style="rounded,filled", fillcolor="lightblue", fontname="Arial", margin="0.2,0.1"];
    edge [fontname="Arial", fontsize=10];

    // States and transitions for cutting process
    start [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 0</b></font></td></tr><tr><td>Start Cutting Process</td></tr></table>>, shape="oval", fillcolor="lightgreen"];
    
    // Initialize cutting state
    init [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkblue" point-size="12"><b>Step 1</b></font></td></tr><tr><td align="left">Initialize Cutting Cycle<br/>- Extend position clamp<br/>- Extend wood secure clamp<br/>- Reset control flags</td></tr></table>>];
    
    // Extend cutter
    extend [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkblue" point-size="12"><b>Step 2</b></font></td></tr><tr><td align="left">Move Cut Motor Forward<br/>- Cut motor moves away from home<br/>- Performs cutting operation</td></tr></table>>];
    
    // Signal transfer arm
    signal [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkblue" point-size="12"><b>Step 3</b></font></td></tr><tr><td align="left">Signal Transfer Arm<br/>- Send 500ms HIGH pulse<br/>- Signal completed</td></tr></table>>];
    
    // Retract cutter
    retract [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkblue" point-size="12"><b>Step 4</b></font></td></tr><tr><td align="left">Move Cut Motor Backward<br/>- Cut motor returns to home<br/>- Cutting operation complete</td></tr></table>>];
    
    // Check wood presence
    check [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkblue" point-size="12"><b>Step 5</b></font></td></tr><tr><td align="left">Check Wood Presence<br/>- Read wood sensor</td></tr></table>>, shape="diamond", fillcolor="lightyellow"];
    
    // Result states  
    yeswood [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 6A</b></font></td></tr><tr><td align="left">YESWOOD_STATE<br/>- Wood detected<br/>- Prepare for next cut cycle</td></tr></table>>, fillcolor="palegreen"];
    nowood [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 6B</b></font></td></tr><tr><td align="left">NOWOOD_STATE<br/>- No wood detected<br/>- End cutting sequence</td></tr></table>>, fillcolor="lightcoral"];
    
    // Error conditions
    error [label="Error Conditions", shape="note", fillcolor="pink"];
    errorwood [label="WOOD_SUCTION_ERROR\n- Suction failure at 0.3 inches", fillcolor="pink"];
    
    // Flow connections
    start -> init;
    init -> extend;
    extend -> signal;
    signal -> retract;
    retract -> check;
    check -> yeswood [label="Wood Present\n(YES_OR_NO_WOOD_SENSOR = LOW)"];
    check -> nowood [label="No Wood\n(YES_OR_NO_WOOD_SENSOR = HIGH)"];
    
    // Error path
    error -> errorwood;
    extend -> errorwood [style="dashed", label="if suction failure"];
    
    // Subgraph for YESWOOD flow
    subgraph cluster_yeswood {
        label="YESWOOD Flow";
        style="dashed";
        bgcolor="palegreen";
        
        yw1 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 7A</b></font></td></tr><tr><td align="left">Retract secure wood clamp</td></tr></table>>];
        yw2 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 8A</b></font></td></tr><tr><td align="left">Move motors to home</td></tr></table>>];
        yw3 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 9A</b></font></td></tr><tr><td align="left">Adjust clamps at 3.35"</td></tr></table>>];
        yw4 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 10A</b></font></td></tr><tr><td align="left">Extend position clamp<br/>at home position</td></tr></table>>];
        yw5 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 11A</b></font></td></tr><tr><td align="left">Check cut motor at home</td></tr></table>>];
        yw6 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 12A</b></font></td></tr><tr><td align="left">Move position motor<br/>to 3.45" position</td></tr></table>>];
        yw7 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 13A</b></font></td></tr><tr><td align="left">Show indicator<br/>(Green + Yellow LEDs)</td></tr></table>>];
        yw8 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 14A</b></font></td></tr><tr><td align="left">Wait for cycle switch toggle</td></tr></table>>];
        yw9 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkgreen" point-size="12"><b>Step 15A</b></font></td></tr><tr><td align="left">Return to READY_STATE</td></tr></table>>];
        
        yw1 -> yw2 -> yw3 -> yw4 -> yw5 -> yw6 -> yw7 -> yw8 -> yw9;
    }
    
    // Subgraph for NOWOOD flow  
    subgraph cluster_nowood {
        label="NOWOOD Flow";
        style="dashed";
        bgcolor="lightcoral";
        
        nw1 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 7B</b></font></td></tr><tr><td align="left">Retract secure wood clamp</td></tr></table>>];
        nw2 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 8B</b></font></td></tr><tr><td align="left">Return both motors home</td></tr></table>>];
        nw3 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 9B</b></font></td></tr><tr><td align="left">Release both clamps</td></tr></table>>];
        nw4 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 10B</b></font></td></tr><tr><td align="left">Set cycle switch toggle flag</td></tr></table>>];
        nw5 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 11B</b></font></td></tr><tr><td align="left">Show indicator<br/>(Green + Blue LEDs)</td></tr></table>>];
        nw6 [label=<<table border="0" cellborder="0" cellspacing="0"><tr><td><font color="darkred" point-size="12"><b>Step 12B</b></font></td></tr><tr><td align="left">Return to READY_STATE</td></tr></table>>];
        
        nw1 -> nw2 -> nw3 -> nw4 -> nw5 -> nw6;
    }
    
    // Connect main flow to subgraphs
    yeswood -> yw1 [style="dashed"];
    nowood -> nw1 [style="dashed"];
} 